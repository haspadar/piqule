name: Markdownlint
on:
  workflow_call:
    inputs:
      node-version:
        type: string
        default: "20"
      config:
        type: string
        required: false
        default: .markdownlint-cli2.jsonc
jobs:
  markdownlint:
    name: Markdownlint
    runs-on: ubuntu-latest
    steps:
      # ------------------------------------------------------------
      # Checkout repository
      # ------------------------------------------------------------
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd  # v6.0.2
      # ------------------------------------------------------------
      # Check markdownlint config existence
      # ------------------------------------------------------------
      - name: Check config exists
        id: check
        env:
          MARKDOWNLINT_CONFIG: ${{ inputs.config }}
        run: |
          if [[ -f "$MARKDOWNLINT_CONFIG" ]]; then
            echo "run=true" >> "$GITHUB_OUTPUT"
          else
            echo "run=false" >> "$GITHUB_OUTPUT"
          fi
      # ------------------------------------------------------------
      # Skip markdownlint when config is missing
      # ------------------------------------------------------------
      - name: Skip — no config found
        if: steps.check.outputs.run == 'false'
        env:
          MARKDOWNLINT_CONFIG: ${{ inputs.config }}
        run: echo "Skipping Markdownlint — no config found at $MARKDOWNLINT_CONFIG"
      # ------------------------------------------------------------
      # Setup Node.js for markdownlint
      # ------------------------------------------------------------
      - name: Setup Node.js
        if: steps.check.outputs.run == 'true'
        uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238  # v6.2.0
        with:
          node-version: ${{ inputs.node-version }}
      # ------------------------------------------------------------
      # Install markdownlint-cli2
      # ------------------------------------------------------------
      - name: Install markdownlint-cli2
        if: steps.check.outputs.run == 'true'
        run: npm install -g markdownlint-cli2@0.20.0
      # ------------------------------------------------------------
      # Run markdownlint-cli2
      # ------------------------------------------------------------
      - name: Run markdownlint-cli2
        if: steps.check.outputs.run == 'true'
        env:
          MARKDOWNLINT_CONFIG: ${{ inputs.config }}
        run: |
          echo "Using config: $MARKDOWNLINT_CONFIG"
          markdownlint-cli2 --config "$MARKDOWNLINT_CONFIG"
